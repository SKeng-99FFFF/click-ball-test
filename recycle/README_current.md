# Aim Trainer 游戏说明文档

## 版本信息
**当前版本：** v3.0.3  
**版本号规范：** A.B.C  
- A: 模式数量 - 当前游戏模式的数量，增加新模式时+1，A+1时B归0
- B: 功能版本 - 实现新功能时+1，添加功能后每次修改时C归0，模式数量不变时添加新功能B+1  
- C: 修改次数 - 当前版本的修改次数，B+1或归0时C归0，或当添加功能后每次修改C+1
- 版本更新规则：A+1时B归0，B+1或归0时C归0

## 项目结构
```
ReactionTests/
├── aim_trainer.py          # 主游戏文件
├── aim_trainer_history.json # 历史记录文件
├── start_game.bat          # 启动批处理文件
├── recycle/               # 回收文件夹
│   ├── version_1.0.txt
│   ├── version_2.0.txt
│   └── ...                # 旧版本说明文档
├── resources/             # 资源文件夹
│   ├── images/            # 图片资源
│   ├── sounds/            # 音效资源  
│   └── fonts/             # 字体资源
└── README.md             # 项目说明文档
```

## 游戏概述
Aim Trainer是一款基于humanbenchmark.com的反应训练游戏，旨在提高玩家的点击速度和准确性。游戏包含两种模式，提供不同的挑战难度。

## 游戏特性

### 基础功能
- **窗口尺寸：** 1280x800 (16:10比例)
- **游戏时间：** 60秒固定时长
- **同屏小球：** 最多3个小球同时显示
- **网格系统：** 方形网格布局，小球在网格中生成
- **计分系统：** 点击小球得分，点击空白区域扣分

### 三模式系统

#### 模式1 (Mode 1) - 基础模式
- **球体大小：** 标准尺寸
- **网格大小：** 球体直径的1.5倍
- **生成区域：** 全游戏区域
- **小球数量：** 最多3个
- **基础分数：** 100分

#### 模式2 (Mode 2) - 高级模式  
- **球体大小：** 模式1的1.75倍（更大的球体）
- **网格大小：** 球体直径的1.3倍（更紧凑的布局）
- **生成区域：** 中心3x3网格区域
- **小球数量：** 最多3个
- **球心位置：** 位于方格对角线交线上（方格中心）
- **基础分数：** 100分

#### 模式3 (Mode 3) - 移动模式
- **球体大小：** 模式1的1.75倍（与模式2相同）
- **网格大小：** 球体直径的1.3倍（与模式2相同）
- **生成区域：** 中心3x3网格区域（与模式2相同）
- **背景移动：** 鼠标移动时整个背景板移动
- **点击机制：** 当小球移动到屏幕中心时点击才记为正确
- **基础分数：** 100分

### 计分系统
- **基础分数：** 每个小球200分
- **点击奖励：** 点击小球获得当前球分数
- **连击机制：** 
  - 连击阈值：`2 * 最大小球数 - 当前同屏小球数 + 1`
  - 连击奖励：基础2分，根据同屏小球数调整
  - 连击计算：`当前连击数 // 连击阈值`
- **错误惩罚：** 点击空白区域或面板区域扣100分
- **允许负分：** 分数可以为负数

### 游戏机制

#### 小球生成规则
- **模式1：** 
  - 全区域生成（避开边缘）
  - 与现有小球间距至少1.5倍网格大小
  - 避免在最后2个消失位置生成
  
- **模式2：**
  - 中心3x3区域生成
  - 更小的生成区域
  - 避免在最后4个消失位置生成
  - 球体间距更严格控制

#### 位置避免机制
- 记录最后消失的20个小球位置
- 避免在相同位置连续生成
- 防止小球重叠和过于接近

### 界面元素
- **信息面板：** 右侧固定面板显示游戏数据
- **实时显示：** 分数、准确率、点击数、连击数
- **当前球分：** 显示下一个小球的预期分数
- **同屏小球：** 显示当前小球数量
- **平均间隔：** 显示点击时间间隔
- **剩余时间：** 倒计时显示
- **统计信息：** 历史记录统计

### 历史记录
- **文件存储：** `aim_trainer_history.json`
- **数据保存：** 每次游戏结果自动保存
- **记录限制：** 保留最近100条记录
- **统计显示：** 显示当前模式的游戏次数、平均分、最高分

## 变量结构

### 1. 通用变量 (三个模式都使用)
- `game_duration`: 游戏持续时间 (毫秒)
- `n`: 同时显示的小球数量 (3)
- `C`: 基础分数 (100) - 模式2和3使用
- `history_file`: 历史记录文件
- `panel_width/height`: 信息面板尺寸
- `game_width/height`: 游戏区域尺寸
- `字体相关`: `font_large/medium/small`

### 2. 基于数学对应关系的变量
- `base_grid_size`: 基础网格大小 (游戏区域最小边的8%)
- `ball_diameter_ratio`: 球体直径比例 (模式1: 1.0, 模式2: 1.75)
- `grid_ball_ratio`: 方格与球体直径比例 (模式1: 1.5, 模式2: 1.3)
- `actual_ball_diameter`: 实际球体直径
- `ball_radius`: 实际球体半径
- `grid_size`: 实际方格边长
- `cols/rows`: 网格行列数

### 3. 专用变量 (模式特有)
- `balls`: 小球列表
- `score`: 当前分数
- `total_clicks/hit_clicks`: 总点击数/命中点击数
- `combo_count`: 连击计数
- `last_ball_positions`: 最后消失位置记录
- `click_effects`: 点击效果列表
- `click_times`: 点击时间记录
- **模式3特定变量:**
  - `offset_x/offset_y`: 背景板偏移量
  - `center_x/center_y`: 游戏区域中心坐标
  - `background_movable`: 背景板移动开关

## 控制方式
- **鼠标点击：** 点击小球得分，点击空白区域扣分
- **ESC键：** 从游戏界面返回模式选择
- **点击"Game Over"区域：** 重新开始当前模式

## 技术特点
- **Pygame框架：** 使用pygame进行图形渲染
- **中文支持：** 完整的中文界面显示
- **性能优化：** 高效的小球生成和碰撞检测
- **数据持久化：** JSON格式存储历史记录
- **响应式设计：** 固定比例窗口布局

## 资源管理
- **图片资源：** 存放在 `resources/images/` 文件夹
- **音效资源：** 存放在 `resources/sounds/` 文件夹
- **字体资源：** 存放在 `resources/fonts/` 文件夹
- **旧文档：** 存放在 `recycle/` 文件夹

## 版本更新记录

### v3.0.3 (当前版本) - 修复版本
- 修正模式3核心逻辑：当中心点在任意小球上时点击即为正确，无论点击窗口哪个位置
- 这是模式3的关键机制：中心点位置是判定位置，不是点击位置
- 按照新规范：A=3(模式数量), B=0(功能版本), C=3(修改次数)

### v3.0.2 - 修复版本
- 修复模式3点击检测问题：正确实现小球在中心时点击的逻辑
- 修正中心检测算法：确保小球覆盖中心点时才能正确点击
- 按照新规范：A=3(模式数量), B=0(功能版本), C=2(修改次数)

### v3.0.1 - 修复版本
- 修复模式3点击检测问题：正确识别小球在中心位置时的点击
- 修复点击间隔计算问题：只计算正确点击之间的时间间隔
- 按照新规范：A=3(模式数量), B=0(功能版本), C=1(修改次数)

### v3.0.0 
- 添加新模式3：移动背景板模式
- 模式3特性：鼠标移动背景板，小球移动到中心时点击得分
- 复用模式2的球体生成规则到模式3
- 模式2和模式3基础分数调整为100分
- 按照新规范：A=3(当前有3个模式), B=0(功能版本), C=0(修改次数)

### v2.0.0 
- 优化变量结构，分为通用变量、数学关系变量、专用变量三类
- 模式2方格边长比例从1.41调整为1.3倍
- 模式2球体直径从模式1的2.25倍调整为1.75倍
- 按照新规范：A=2(当前有2个模式), B=0(功能版本), C=0(修改次数)
- 整理项目结构，创建资源文件夹和回收文件夹

### v1.10.0 - 功能添加版本
- 添加双模式系统 (模式1和模式2)
- 实现模式特定的生成规则和布局
- 优化网格和小球关系算法
- 按照新规范：A=1(模式数量), B=10(功能版本), C=0(修改次数重置)

### v1.0.9
- 添加连击奖励系统
- 实现动态计分机制
- 按照新规范：A=1(模式数量), B=9(功能版本), C=0(修改次数重置)

### v1.0.8
- 优化小球生成算法
- 添加位置避免机制
- 按照新规范：A=1(模式数量), B=8(功能版本), C=0(修改次数重置)

### v1.0.7
- 添加历史记录功能
- 实现统计显示
- 按照新规范：A=1(模式数量), B=7(功能版本), C=0(修改次数重置)

### v1.0.6
- 优化界面布局
- 添加信息面板
- 按照新规范：A=1(模式数量), B=6(功能版本), C=0(修改次数重置)

### v1.0.5
- 添加准确率计算
- 优化游戏流程
- 按照新规范：A=1(模式数量), B=5(功能版本), C=0(修改次数重置)

### v1.0.4
- 添加平均点击间隔计算
- 优化计分显示
- 按照新规范：A=1(模式数量), B=4(功能版本), C=0(修改次数重置)

### v1.0.3
- 修复时间函数问题
- 优化计时系统
- 按照新规范：A=1(模式数量), B=3(功能版本), C=0(修改次数重置)

### v1.0.2
- 修复中文显示问题
- 优化字体渲染
- 按照新规范：A=1(模式数量), B=2(功能版本), C=0(修改次数重置)

### v1.0.1
- 修复计分系统问题
- 优化游戏结束条件
- 按照新规范：A=1(模式数量), B=1(功能版本), C=0(修改次数重置)

### v1.0.0
- 基础Aim Trainer功能
- 网格系统和小球生成
- 计分系统和时间控制
- 按照新规范：A=1(模式数量), B=0(功能版本), C=0(修改次数)